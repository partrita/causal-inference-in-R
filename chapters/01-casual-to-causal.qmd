\mainmatter

# 평상시에서 인과관계로 {#sec-causal-question}

{{< include 00-setup.qmd >}}

```{r}
#| echo: false
# TODO: 첫 번째 판이 완료되면 제거
status("complete")
```

## 평상시 추론

인과 분석의 핵심은 인과적 질문입니다. 이 질문은 우리가 분석할 데이터, 분석 방법, 그리고 추론이 적용될 모집단을 결정합니다.
이 책은 본질적으로 응용적이므로 주로 인과 추론의 분석 단계를 다룹니다.
좋은 인과적 질문을 명시하는 복잡성에 비해 분석 단계는 상당히 간단합니다.
이 책의 처음 여섯 장에서는 인과적 질문이 무엇인지, 질문을 개선하는 방법, 그리고 몇 가지 예를 살펴보겠습니다.

인과적 질문은 데이터 과학의 주요 과제인 설명, 예측, 인과 추론과 관련된 통계적 기법으로 물을 수 있는 더 넓은 질문 집합의 일부입니다 [@hernan2019].
불행히도 이러한 과제는 우리가 사용하는 기법(예를 들어 회귀는 세 가지 과제 모두에 유용함)과 우리가 그것에 대해 이야기하는 방식 때문에 종종 혼란스러워집니다.
연구자들이 비무작위 데이터로부터 인과 추론에 관심이 있을 때, 우리는 종종 인과 효과를 추정하려는 의도를 밝히는 대신 "연관성"과 같은 완곡한 표현을 사용합니다 [@Hernan2018].

예를 들어, 최근 역학 연구에서 분석 언어에 대한 연구에서 추정된 효과를 설명하는 가장 일반적인 어근은 "연관시키다"였지만, 많은 연구자들은 "연관시키다"가 적어도 *어느 정도* 인과적 효과를 암시한다고 생각했습니다(@fig-word-ranking) [@haber_causal_language].
분석된 연구 중 약 1%만이 "원인"이라는 어근을 전혀 사용했습니다.
그러나 연구의 3분의 1은 실행 권장 사항을 가지고 있었고, 연구자들은 이러한 권장 사항의 80%가 적어도 어느 정도 인과적 함의를 가지고 있다고 평가했습니다.
종종 이러한 연구는 효과 설명( "연관시키다" 및 "비교하다"와 같은 어근)에서 암시하는 것보다 더 강력한 실행 권장 사항(인과 효과를 암시함)을 가지고 있습니다.
얼마나 많은 연구가 목표가 인과 추론임을 암시했음에도 불구하고, 이 책에서 논의된 것과 같은 공식적인 인과 모델을 사용한 연구는 약 4%에 불과했습니다.
그러나 대부분은 이전 연구나 이론에 의해 그러한 원인이 어떻게 정당화될 수 있는지 논의했습니다.

```{r}
#| label: "fig-word-ranking"
#| fig.cap: "연구자들이 사용한 어근의 인과적 강도 순위. 강한 순위가 많은 어근은 없음 또는 약함 순위가 많은 어근보다 인과적 함의가 더 강합니다. 데이터 출처: @haber_causal_language."
#| fig.height: 9
#| echo: false

rankings <- read_csv(here::here("data/word_rankings.csv"), show_col_types = FALSE) |>
  janitor::clean_names()

lvls <- rankings |>
  count(rating, root_word) |>
  filter(rating == "Strong") |>
  arrange(desc(n)) |>
  mutate(root_word = fct_inorder(root_word)) |>
  pull(root_word) |>
  levels()

rankings |>
  count(rating, root_word) |>
  mutate(root_word = factor(root_word, levels = lvls)) |>
  filter(!is.na(root_word)) |>
  group_by(rating) |>
  mutate(rank = n / sum(n)) |>
  ungroup() |>
  drop_na(rating) |>
  mutate(rating = factor(rating, levels = c("None", "Weak", "Moderate", "Strong"))) |>
  ggplot(aes(x = rank, y = root_word, fill = rating)) +
  geom_col(position = position_fill(reverse = TRUE)) +
  scale_fill_viridis_d(direction = -1) +
  labs(
    title = "어근의 인과적 강도",
    subtitle = glue::glue(
      "어근 순위: ",
      '<span style="color:#FDE725FF">**없음**</span>, ',
      '<span style="color:#35B779FF">**약함**</span>, ',
      '<span style="color:#31688EFF">**보통**</span>, ',
      '또는 <span style="color:#440154FF">**강함**</span>'
    ),
    x = NULL,
    y = NULL
  ) +
  scale_x_continuous(labels = scales::percent) +
  theme(
    axis.ticks = element_blank(),
    panel.grid.major = element_blank(),
    plot.title.position = "plot",
    plot.subtitle = ggtext::element_markdown(),
    legend.position = "none"
  )
```

명확한 가정과 목표를 가진 명확한 질문 대신, 우리는 "슈뢰딩거의 인과 추론"으로 끝나게 됩니다.

> 우리의 결과는 "슈뢰딩거의 인과 추론" - 연구가 인과 효과 추정에 대한 관심을 명시적으로 부인하거나 심지어 부인하면서도 인과적 의도, 추론, 함의 및 권장 사항이 포함되어 있는 경우 - 이 일반적임을 시사합니다.
>
> --- @haber_causal_language

이 접근 방식은 *평상시* 추론의 한 예입니다. 인과적 질문을 이해하고 그에 답하기 위한 가정을 다루는 데 필요한 작업을 수행하지 않고 추론을 내리는 것입니다.

## 설명, 예측 및 해명

이 문제를 해결하기 위한 훌륭한 첫 번째 단계는 설명, 예측 및 해명에 대한 질문이 근본적으로 다르다는 것을 인식하는 것입니다.
업계의 데이터 과학은 학문 과학만큼 슈뢰딩거의 인과 추론에 시달리지는 않지만, *평상시* 추론은 다른 여러 방식으로 발생합니다.
예를 들어, 이해 관계자가 특정 이벤트의 "동인"을 요청할 때 그들은 무엇을 묻는 것일까요?
이벤트를 예측하는 모델을 원할까요?
이벤트의 원인에 대한 더 깊은 이해를 원할까요?
모호한 요청이지만 우리에게는 인과적 관심의 냄새가 납니다. 그러나 많은 데이터 과학자들은 이 질문에 예측 모델로 답하려는 유혹을 받을 것입니다.
목표가 명확하면 세 가지 접근 방식을 모두 더 효과적으로 사용할 수 있습니다(그리고 보게 되겠지만, 목표가 인과 추론을 하는 것일 때 설명 분석과 예측 모델 모두 여전히 유용합니다).
또한 세 가지 접근 방식 모두 유용한 의사 결정 도구입니다.

### 설명

설명 분석은 변수의 분포를 설명하는 것을 목표로 하며, 종종 주요 관심 변수로 계층화됩니다.
밀접하게 관련된 아이디어는 탐색적 데이터 분석(EDA)이지만, 설명 연구는 종종 EDA보다 더 명시적인 목표를 가지고 있습니다.

설명 분석은 일반적으로 중심 경향성(평균, 중앙값) 및 산포도(최솟값, 최댓값, 사분위수)와 같은 통계적 요약에 기반하지만, 때때로 회귀 모델링과 같은 기법도 사용합니다.
회귀와 같은 고급 기법을 적용하는 목표는 설명 분석에서 예측 또는 인과 연구와 다릅니다.
설명 분석에서 변수를 "조정"한다는 것은 연관 효과를 제거한다는 의미이며(따라서 질문을 변경함), 교란을 통제한다는 의미는 *아닙니다*.

역학에서 설명 분석에 유용한 개념은 "사람, 장소, 시간"입니다. 즉, 누가 어떤 질병을 앓고 있는지, 어디서, 언제 앓고 있는지입니다.
이 개념은 다른 분야의 설명 분석에도 좋은 템플릿입니다.
일반적으로 우리는 어떤 모집단을 설명하려고 하는지 명확히 하고 싶으므로 가능한 한 구체적으로 설명해야 합니다.
인간 건강의 경우 관련된 사람, 위치 및 기간을 설명하는 것이 모두 중요합니다.
즉, 데이터 이해를 생성하는 기본 원칙에 초점을 맞추고 그에 따라 데이터를 설명하십시오.

#### 예시

데이터로 할 수 있는 가장 좋은 일 중 하나는 사물을 세는 것입니다.
EDA는 예측 분석과 인과 분석 모두에 도움이 되지만, 설명 분석은 다른 분석 작업과 독립적으로 가치가 있습니다.
복잡한 기계 학습 모델을 개발할 것이라고 생각했지만 대부분의 시간을 대시보드에 할애하게 된 데이터 과학자에게 물어보십시오.
데이터 분포, 특히 주요 분석 목표(예: 업계의 KPI 또는 역학의 질병 발생률)에 대한 이해는 여러 유형의 의사 결정에 중요합니다.

최근 설명 분석의 가장 좋은 예 중 하나는 COVID-19 팬데믹에서 비롯되었습니다 [@Fox2022].
2020년, 특히 팬데믹 초기 몇 달 동안 설명 분석은 위험을 이해하고 자원을 할당하는 데 필수적이었습니다.
코로나바이러스는 다른 호흡기 질환과 유사하므로 위험을 줄이기 위한 많은 공중 보건 도구(예: 거리두기, 나중에는 안면 마스크)를 가지고 있었습니다.
지역별 사례에 대한 설명 통계는 지역 정책과 해당 정책의 강도를 결정하는 데 필수적이었습니다.

팬데믹 기간 동안의 보다 복잡한 설명 분석의 훌륭한 예는 다양한 국가 및 지역에서 [예상 사망자 수 대 관찰된 사망자 수에 대한 Financial Times의 지속적인 보고서](https://www.ft.com/content/a2901ce8-5eb7-4633-b89c-cbdf5b386938)였습니다[^01-casual-to-causal-1].
예상 사망자 수 계산은 대부분의 설명 통계보다 약간 더 정교하지만, 인과 효과를 풀 필요 없이 현재 사망자 수에 대한 엄청난 양의 정보를 제공했습니다(예: COVID-19로 직접 인한 것인가? 접근 불가능한 의료 서비스 때문인가? COVID 이후 심혈관 질환 때문인가?).
2020년 7월의 이 (단순화된) 플롯 재현에서 팬데믹 초기 몇 달의 엄청난 영향을 볼 수 있습니다.

[^01-casual-to-causal-1]: 존 번-머독은 이러한 프레젠테이션 중 다수를 담당했으며 [주제에 대한 흥미로운 강연](https://cloud.rstudio.com/resources/rstudioglobal-2021/reporting-on-and-visualising-the-pandemic/)을 했습니다.

```{r}
#| label: fig-ft-chart
#| fig-width: 10
#| fig-height: 7.5
#| fig-cap: "2020년 초과 사망자 수 대 과거 예상 사망자 수(모든 원인). 데이터 출처: Financial Times."
#| echo: false
#| message: false
ft_excess_deaths <- read_csv(here::here("data/ft_excess_deaths.csv")) |>
  mutate(year = factor(year))

excess_deaths_prior_wk <- ft_excess_deaths |>
  filter(year != 2020)

excess_deaths2020_wk <- ft_excess_deaths |>
  filter(year == 2020)

excess_deaths_wk <- ft_excess_deaths |>
  filter(year == 2020)

ggplot(
  data = excess_deaths_prior_wk,
  aes(x = week, y = deaths, group = year)
) +
  geom_line(color = "grey75", alpha = 0.6) +
  geom_line(
    data = excess_deaths2020_wk,
    color = "#D55E00"
  ) +
  geom_ribbon(
    data = excess_deaths2020_wk,
    aes(ymin = pmin(deaths, expected_deaths), ymax = deaths),
    fill = "#D55E00",
    alpha = 0.7
  ) +
  geom_line(
    data = excess_deaths_wk,
    aes(x = week, y = expected_deaths),
    color = "steelblue",
    linewidth = 0.9,
    inherit.aes = FALSE
  ) +
  facet_wrap(vars(country), scales = "free_y") +
  scale_y_continuous(labels = scales::label_comma(), n.breaks = 4) +
  labs(
    x = NULL,
    y = NULL,
    title = "<span style = 'color:#D55E00;'>**2020년 사망자 수**</span> 대 <span style = 'color:#4682b4;'>**예상 사망자 수**</span> 비교",
    subtitle = "주간 모든 원인 사망자 수 대 최근 몇 년"
  ) +
  theme(
    text = element_text(size = 18),
    axis.text.x = element_blank(),
    plot.title = ggtext::element_markdown(),
    plot.title.position = "plot"
  )
```

다음은 설명 분석의 다른 훌륭한 예입니다.

-   **전 세계 삼림 벌채**. Our World in Data [@owidforestsanddeforestation]는 다양한 주제에 대해 사려 깊고 일반적으로 설명적인 보고서를 작성하는 데이터 저널리즘 조직입니다. 이 보고서에서 그들은 삼림 피복의 절대적 변화(삼림 전환)와 상대적 변화(삼림 벌채 또는 재조림) 모두에 대한 데이터 시각화를 제시하며, 기본 통계와 임업 이론을 사용하여 시간 경과에 따른 삼림 상태에 대한 유용한 정보를 제공합니다.
-   **클라미디아 및 임균 감염 유병률** [@Miller2004]. 질병 유병률(현재 질병을 앓고 있는 사람의 수, 일반적으로 사람 수당 비율로 표시됨)을 측정하는 것은 기본 공중 보건(자원, 예방, 교육) 및 과학적 이해에 유용합니다. 이 연구에서 저자들은 미국 전역의 모든 고등학교(대상 모집단)를 대표하도록 설계된 복잡한 설문 조사를 수행했습니다. 그들은 질문과 관련된 다양한 요인을 해결하기 위해 설문 가중치를 사용한 다음 유병률 비율 및 기타 통계량을 계산했습니다. 보게 되겠지만, 가중치는 동일한 이유로 인과 추론에 유용합니다. 즉, 특정 모집단을 대상으로 합니다. 즉, 모든 가중치 기법이 본질적으로 인과적인 것은 아니며 여기서는 그렇지 않았습니다.
-   **인종 및 민족별 자궁 절제술 불평등 추정** [@Gartner2020]. 설명 기법은 경제학 및 역학과 같은 분야의 격차를 이해하는 데도 도움이 됩니다. 이 연구에서 저자들은 다음과 같이 질문했습니다. 자궁 절제술의 위험은 인종 또는 민족 배경에 따라 다른가? 분석이 주요 변수로 계층화되었지만 여전히 설명적입니다. 이 논문의 또 다른 흥미로운 측면은 연구가 올바른 대상 모집단에 대한 질문에 답하도록 보장하는 저자들의 작업입니다. 그들의 분석은 여러 데이터 소스를 결합하여 실제 모집단 유병률(일반적으로 제시되는 병원 환자의 유병률 대신)을 더 잘 추정했습니다. 그들은 또한 자궁 절제술 유병률을 조정했습니다. 예를 들어, 실제로 자궁 절제술을 받을 수 있는 사람들(예: 아직 받지 않은 사람들) 사이에서만 발생률(새로운 사례)을 계산했습니다.

#### 타당성

설명 분석에는 측정 오류와 샘플링 오류라는 두 가지 중요한 타당성 문제가 있습니다.

측정 오류는 하나 이상의 변수를 어떤 식으로든 잘못 측정했을 때 발생합니다.
설명 분석의 경우, 사물을 잘못 측정하면 질문에 대한 답을 얻지 못할 수 있습니다.
그러나 그 정도는 측정 오류의 심각성과 질문 자체에 따라 달라집니다.

샘플링 오류는 설명 분석에서 더 미묘한 주제입니다.
이는 우리가 분석하는 모집단(분석이 누구에 대한 설명을 생성해야 하는가)과 불확실성(우리가 데이터를 가지고 있는 사람들에 대한 설명이 우리가 설명하려는 모집단을 대표한다는 것을 얼마나 확신하는가)과 관련이 있습니다.

유효한 설명을 제공하려면 데이터가 나온 모집단과 설명하려는 모집단이 동일해야 합니다.
온라인 설문 조사에서 생성된 데이터셋을 생각해 보십시오.
이러한 질문에 답하는 사람들은 누구이며, 우리가 설명하고 싶은 사람들과 어떤 관련이 있습니까?
많은 분석에서 설문 조사에 답하는 데 시간을 할애하는 사람들은 우리가 설명하고 싶은 사람들과 다릅니다. 예를 들어, 설문 조사를 작성하는 사람들의 그룹은 그렇지 않은 사람들보다 변수 분포가 다를 수 있습니다.
이러한 데이터의 결과는 기술적으로 편향되지 않았습니다. 왜냐하면 표본 크기 관련 불확실성과 측정 오류를 제외하고 설명은 정확하기 때문입니다. 단지 올바른 사람들의 그룹에 대한 것이 아닐 뿐입니다!
즉, *우리는 잘못된 질문에 대한 답을 얻었습니다*.

특히, 때때로 우리의 데이터는 전체 모집단(또는 충분히 가까움)을 나타내므로 샘플링 오류는 관련이 없습니다.
서비스를 사용하는 모든 고객에 대한 특정 데이터를 가진 회사를 생각해 보십시오.
많은 분석에서 이는 우리가 정보를 원하는 전체 모집단(현재 고객)을 나타냅니다.
마찬가지로, 인구 전체 건강 등록부가 있는 국가에서는 특정 실제 목적에 사용할 수 있는 데이터가 전체 모집단에 충분히 가까워서 샘플링이 필요하지 않습니다(연구자들은 더 간단한 계산을 위해 샘플링을 사용할 수 있지만).
이러한 경우 불확실성과 같은 것은 실제로 없습니다.
모든 것이 잘 측정되었다고 가정하면, 우리가 생성하는 요약 통계는 모집단의 모든 사람으로부터 정보를 얻었기 때문에 *본질적으로 편향되지 않고 정확합니다*.
물론 실제로는 최상의 상황에서도 일반적으로 측정 오류, 결측 데이터 등이 혼합되어 있습니다.

설명 분석의 한 가지 중요한 세부 사항은 이 책의 주요 관심사 중 하나인 교란 편향이 정의되지 않았다는 것입니다.
이는 교란이 인과적 관심사이기 때문입니다.
설명 분석은 관계의 통계적 설명 *그대로*이며, 그 관계 뒤에 있는 메커니즘이 아니기 때문에 교란될 수 없습니다.

#### 인과 추론과의 관계

인간은 패턴을 매우 잘 봅니다.
패턴 찾기는 우리 뇌의 유용한 기능이지만, 유효하게 그렇게 할 수 없는 데이터나 방법으로 작업하지 않을 때는 추론의 미끄러운 경사면으로 이어질 수도 있습니다.
목표가 설명일 때 가장 주의해야 할 점은 설명에서 인과 관계로 (암묵적이든 명시적이든) 도약하는 것입니다.

그러나 물론, 설명 분석은 인과 효과를 추정할 때 유용합니다.
이는 우리가 작업하는 모집단, 결과 분포, 노출(인과적일 수 있다고 생각하는 변수) 및 교란 변수(노출에 대한 편향되지 않은 인과 효과를 얻기 위해 고려해야 하는 변수)를 이해하는 데 도움이 됩니다.
또한 [Chapter -@sec-data-causal]에서 보게 되겠지만, 우리가 사용하는 데이터 구조가 우리가 답하려는 질문과 일치하는지 확인하는 데 도움이 됩니다.
인과 연구를 수행할 때는 항상 데이터에 대한 설명 분석을 수행해야 합니다.

마지막으로, [Chapter -@sec-strat-outcome]에서 보게 되겠지만, 기본 통계로 인과 추론을 할 수 있는 특정 상황이 있습니다.
여기서도 인과적 질문과 설명적 구성 요소의 구분에 주의하십시오. 동일한 계산(예: 평균 차이)을 사용한다고 해서 생성할 수 있는 모든 설명이 인과적인 것은 아닙니다.
설명 분석이 인과 분석과 중복되는지 여부는 데이터와 질문의 함수입니다.

### 예측

예측의 목표는 데이터를 사용하여 변수에 대한 정확한 예측을 하는 것이며, 일반적으로 새로운 데이터에 대해 수행됩니다.
이것이 의미하는 바는 질문, 영역 등에 따라 다릅니다.
예측 모델은 동료 심사를 거친 임상 모델에서 소비자 장치에 내장된 맞춤형 기계 학습 모델에 이르기까지 상상할 수 있는 거의 모든 환경에서 사용됩니다.
ChatGPT의 기반이 되는 것과 같은 대규모 언어 모델조차도 예측 모델입니다. 즉, 프롬프트에 대한 응답이 어떻게 보일지 예측합니다.

예측 모델링은 일반적으로 이 책에서 제시할 인과 모델링 워크플로와 다른 워크플로를 사용합니다.
예측의 목표는 일반적으로 새로운 데이터에 대한 예측을 하는 것과 관련이 있으므로 이러한 유형의 모델링 워크플로는 예측 정확도를 최대화하면서 새로운 데이터에 대한 일반화를 유지하는 데 중점을 둡니다. 이를 편향-분산 트레이드오프라고도 합니다.
실제로 이는 데이터를 훈련 세트(모델을 구축하는 데이터 부분)와 테스트 세트(모델을 평가하는 부분, 새로운 데이터에서 어떻게 수행될지에 대한 대리)로 분할하는 것을 의미합니다.
일반적으로 데이터 과학자들은 교차 검증 또는 기타 샘플링 기법을 사용하여 훈련 세트에 모델을 과적합할 위험을 더욱 줄입니다.

예측 모델링에 대한 훌륭한 교재가 많이 있으므로 이러한 기법의 목표와 방법에 대한 더 깊은 탐구를 위해 해당 교재를 참조하십시오 [@kuhn2013a; @harrell2001; @Kuhn_Silge_2022; @James_Witten_Hastie_Tibshirani_2022].

#### 예시

예측은 데이터 과학에서 가장 인기 있는 주제이며, 주로 업계의 기계 학습 응용 프로그램 덕분입니다.
물론 예측은 통계학에서 오랜 역사를 가지고 있으며, 오늘날 인기 있는 많은 모델은 수십 년 동안 학계 안팎에서 사용되어 왔습니다.

COVID-19에 대한 예측 예를 살펴보겠습니다[^01-casual-to-causal-2].
2021년에 연구자들은 급성 COVID-19에 대한 심각한 부작용을 예측하기 위한 임상 예후 모델인 ISARIC 4C 악화 모델을 발표했습니다[@Gupta2021].
저자들은 이 모델이 개발된 모집단, 특히 결과 및 후보 예측 변수의 분포를 이해하기 위해 설명 분석을 포함했습니다.
이 모델의 한 가지 유용한 측면은 COVID 관련 입원 첫날에 일반적으로 측정되는 항목을 사용한다는 것입니다.
저자들은 영국 지역별 교차 검증을 사용하여 이 모델을 구축한 다음 보류 지역의 데이터로 모델을 테스트했습니다.
최종 모델에는 11개 항목과 모델 속성, 결과와의 관계 등에 대한 설명이 포함되었습니다.
특히 저자들은 임상 영역 지식을 사용하여 후보 변수를 선택했지만 모델 계수를 인과적으로 해석하려는 유혹에 빠지지 않았습니다.
의심할 여지 없이 이 모델의 예측 가치 중 일부는 결과와 관련된 변수의 인과 구조에서 비롯되지만, 연구자들은 이 모델에 대해 전혀 다른 목표를 가지고 있었고 이를 고수했습니다.

[^01-casual-to-causal-2]: 여기서 자연스러운 모델은 사례를 예측하는 것이지만, 전염병 모델링은 복잡하며 일반적으로 일반적인 예측 모델링 워크플로 외부의 기법을 사용합니다.

다음은 예측 분야의 다른 좋은 예입니다.

-   예측 모델링에서 가장 흥미로운 작업 중 일부는 업계에서 이루어지고 있습니다.
    Netflix는 정기적으로 [연구 블로그](https://research.netflix.com/)에서 모델링 성공 및 새로운 전략에 대한 세부 정보를 공유합니다.
    그들은 또한 최근 추천 시스템(이 경우 사용자에게 프로그램 및 영화 추천)을 위한 딥 러닝 모델 사용을 검토하는 논문을 발표했습니다[@steck2021].
    저자들은 모델 실험, 해당 모델의 세부 정보 및 직면한 많은 과제를 설명하여 이러한 모델 사용에 대한 실용적인 가이드를 제공합니다.

-   2020년 초, 건강 연구에서 예측 및 예후 모델링 경험이 있는 연구자들은 COVID-19 진단 및 예후 모델에 대한 검토를 발표했습니다[@Wynants2020].
    이 검토는 그 폭뿐만 아니라 품질이 낮은 것으로 평가된 놀라운 수의 모델 때문에 흥미롭습니다. "[232]개 모델은 편향 위험이 높거나 불분명한 것으로 평가되었으며, 이는 주로 대조군 환자의 비대표적 선택, 연구 종료 시점에 관심 사건을 경험하지 않은 환자 제외, 모델 과적합 위험이 높음, 불분명한 보고 때문이었습니다." 이 연구는 또한 [살아있는 검토](https://www.covprecise.org/)입니다.

#### 타당성

예측 모델링에서 타당성의 핵심 척도는 예측 정확도이며, 이는 평균 제곱근 오차(RMSE), 평균 절대 오차(MAE), 곡선 아래 면적(AUC) 등 여러 가지 방법으로 측정할 수 있습니다.
예측 모델링의 편리한 세부 사항은 우리가 종종 우리가 옳은지 평가할 수 있다는 것입니다. 이는 데이터의 하위 집합만 있는 설명 통계나 실제 인과 구조를 모르는 인과 추론의 경우에는 해당되지 않습니다.
우리는 항상 진실에 대해 평가할 수 있는 것은 아니지만, 초기 예측 모델을 적합시키는 데 거의 항상 필요합니다[^01-casual-to-causal-3].

[^01-casual-to-causal-3]: 우리는 단일 모델이라고 말하지만, 일반적으로 데이터 과학자들은 실험을 위해 많은 모델을 적합시키며, 종종 최고의 예측 모델은 여러 모델의 예측을 결합한 스택 모델입니다.

측정 오류는 정확한 예측을 위해 일반적으로 정확한 데이터가 필요하기 때문에 예측 모델링에서도 우려 사항입니다.
흥미롭게도 측정 오류와 결측은 예측 환경에서 유익할 수 있습니다.
인과적 환경에서는 이것이 편향을 유발할 수 있지만, 예측 모델은 문제 없이 해당 정보를 소비할 수 있습니다.
예를 들어, 유명한 Netflix Prize에서 우승 모델은 고객이 영화를 평가했는지 여부에 대한 정보를 활용하여 추천 시스템을 개선했습니다.

설명 분석과 마찬가지로 예측 모델링에서는 교란이 정의되지 않습니다.
예측 모델의 계수는 교란될 수 없습니다. 우리는 변수가 예측 정보를 제공하는지 여부에만 관심이 있으며, 해당 정보가 인과 관계 때문인지 아니면 다른 것 때문인지는 중요하지 않습니다.

#### 인과 추론과의 관계

예측에서 가장 큰 위험은 모델의 특정 계수가 인과적 해석을 갖는다고 가정하는 것입니다.
그렇지 않을 가능성이 높습니다.
모델은 잘 예측할 수 있지만 인과적 관점에서 완전히 편향된 계수를 가질 수도 있습니다.
이에 대해서는 @sec-pred-or-explain 및 이 책의 나머지 부분에서 자세히 살펴보겠습니다.

종종 사람들은 예측 모델의 특징(변수)을 선택하는 방법을 잘못 사용하여 인과 모델의 교란 변수를 선택합니다.
과적합 위험 외에도 이러한 방법은 예측 모델에는 적합하지만 인과 모델에는 적합하지 않습니다.
예측 지표는 질문의 인과 구조를 결정할 수 없으며, 결과에 대한 예측 가치는 변수를 교란 변수로 만들지 않습니다.
일반적으로 배경 지식(예측 또는 연관 통계가 아님)이 인과 모델의 변수를 선택하는 데 도움이 되어야 합니다 @robinsImpossible. 이 과정은 [Chapter -@sec-dags] 및 [Chapter -@sec-building-models]에서 자세히 논의할 것입니다.

그럼에도 불구하고 예측은 인과 추론에 매우 중요합니다.
철학적 관점에서 볼 때, 우리는 서로 다른 *만약* 시나리오의 예측을 비교하고 있습니다. 즉, 한 가지 일이 일어났을 때와 다른 일이 일어났을 때 결과는 어떠했을까요?
우리는 이 주제, 특히 [Chapter -@sec-counterfactuals]에서 많은 시간을 할애할 것입니다.
또한 실용적인 관점에서 예측에 대해 많이 이야기할 것입니다. 예측 및 일부 설명과 마찬가지로 모델링 기법을 사용하여 인과적 질문에 답할 것입니다.
성향 점수 방법 및 g-계산과 같은 기법은 모델 예측을 사용하여 인과적 질문에 답하지만, 모델 자체를 구축하고 해석하는 워크플로는 상당히 다릅니다.

### 인과 추론

인과 추론의 목표는 때때로 노출이라고 불리는 변수가 때때로 결과라고 불리는 다른 변수에 미치는 영향을 이해하는 것입니다.
"노출"과 "결과"는 이 책에서 우리가 관심 있는 인과 관계를 설명하는 데 사용할 용어입니다.
중요한 것은 우리의 목표가 이 질문에 명확하고 정확하게 답하는 것입니다.
실제로 이는 연구 설계(예: 무작위 시험) 또는 통계적 방법(예: 성향 점수)과 같은 기법을 사용하여 노출이 결과에 미치는 편향되지 않은 효과를 계산하는 것을 의미합니다.

예측 및 설명과 마찬가지로 명확하고 정확한 질문으로 시작하여 명확하고 정확한 답을 얻는 것이 좋습니다.
통계 및 데이터 과학, 특히 현대 세계의 데이터 바다를 헤엄칠 때, 우리는 종종 질문 없이 답을 얻게 됩니다(예: [`42`](https://en.wikipedia.org/wiki/42_(number)#The_Hitchhiker's_Guide_to_the_Galaxy)).
물론 이것은 답의 해석을 어렵게 만듭니다.
@sec-diag에서는 인과적 질문의 구조에 대해 논의할 것입니다.
[Chapter -@sec-counterfactuals]에서는 질문을 날카롭게 하는 철학적이고 실용적인 방법에 대해 논의할 것입니다.

::: callout-note
## 인과 추론과 설명

일부 저자는 "인과 추론"과 "설명"이라는 문구를 같은 의미로 사용합니다.
우리는 그것에 대해 좀 더 신중합니다.
인과 추론은 항상 설명과 관련이 있지만, 한 가지가 다른 것에 미치는 영향을 그것이 어떻게 일어나는지 이해하지 않고도 정확하게 추정할 수 있습니다.

역학의 아버지라고 불리는 존 스노우를 생각해 보십시오.
1854년, 스노우는 런던의 콜레라 발생을 조사하여 특정 수원지가 질병의 원인임을 확인했습니다.
그는 옳았습니다. 오염된 물은 콜레라 전파의 메커니즘이었습니다.
그러나 그는 그것이 어떻게 일어나는지 설명할 만큼 충분한 정보를 가지고 있지 않았습니다. 콜레라의 원인균인 *비브리오 콜레라*는 거의 30년 후에야 확인되었습니다.
:::

#### 예시

이 책에서는 인과 추론의 많은 예를 보게 되겠지만, COVID-19와 관련된 예로 계속 진행해 보겠습니다.
팬데믹이 계속되고 백신 및 항바이러스 치료제와 같은 도구가 사용 가능해짐에 따라 보편적 마스크 착용과 같은 정책도 변경되기 시작했습니다.
2022년 2월, 미국 매사추세츠주는 공립학교에서 보편적 마스크 착용을 요구하는 주 전체 정책을 철회했습니다[@Cowger2022].
보스턴 광역 지역에서는 일부 학군이 정책을 계속 유지했지만 다른 학군은 중단했습니다. 중단한 학군도 정책 변경 후 몇 주에 걸쳐 서로 다른 시기에 중단했습니다.
이러한 정책 차이로 인해 연구자들은 이 기간 동안 학군 정책의 차이를 활용하여 보편적 마스크 착용이 COVID-19 사례에 미치는 영향을 연구할 수 있었습니다.
연구자들은 COVID-19 및 기타 건강 결정 요인과 관련된 요인의 분포를 이해하기 위해 학군에 대한 설명 분석을 포함했습니다.
보편적 마스크 착용이 사례에 미치는 영향을 추정하기 위해 저자들은 정책 관련 인과 추론에서 일반적인 기법인 차이 속 차이(difference-in-differences)를 사용하여 이 효과를 추정했습니다(@sec-did에서 논의할 예정).
저자들은 마스크 착용을 계속한 학군이 그렇지 않은 학군보다 사례 수가 훨씬 적다는 것을 발견했습니다. 그들의 분석에 따르면 정책 변경으로 인해 거의 12,000건의 추가 사례가 발생했으며, 이는 연구 15주 동안 해당 학군 사례의 거의 30%에 해당합니다.

<!-- TODO: 코드와 데이터가 사용 가능할 때 예제 추가 -->

다음은 몇 가지 다른 흥미로운 예입니다.

-   Netflix는 정기적으로 작업에 인과 추론을 사용합니다.
    2022년에 그들은 자신들이 참여한 [일부 인과적 작업 요약 블로그 게시물](https://netflixtechblog.com/a-survey-of-causal-inference-applications-at-netflix-b62d25175e6f)을 게시했습니다.
    한 가지 흥미로운 예는 현지화입니다.
    전 세계적인 Netflix는 자막과 더빙을 통해 콘텐츠를 현지화합니다.
    무작위 실험은 사용자에게 콘텐츠를 제공하지 않는 것을 의미했기 때문에 좋은 생각이 아니었습니다. 따라서 Netflix의 연구자들은 잠재적인 교란을 해결하면서 현지화의 가치를 이해하기 위해 여러 가지 접근 방식을 사용했습니다.
    한 가지 예는 팬데믹 관련 더빙 지연의 영향을 연구하는 것입니다.
    연구자들은 합성 대조군(@sec-did)을 사용하여 이러한 지연이 있거나 없는 경우 시청률에 미치는 영향을 시뮬레이션했습니다.
    아마도 팬데믹 관련 지연 시점은 일반적으로 더빙 과정과 관련된 많은 요인과 관련이 없었으므로 잠재적인 교란 중 일부가 줄어들었을 것입니다.

-   터스키기 연구는 현대사에서 가장 악명 높은 의료 학대 사례 중 하나입니다.
    이는 일반적으로 흑인 미국인의 의료계에 대한 불신의 원인으로 지적됩니다.
    건강 경제학 연구자들은 터스키기 연구가 노인 흑인 남성의 불신과 기대 수명에 미치는 영향을 평가하기 위해 차이 속 차이 기법의 변형을 사용했습니다[@Alsan2018].
    결과는 중요하고 충격적입니다. "1972년 연구 공개는 노인 흑인 남성의 의료 불신 및 사망률 증가와 외래 및 입원 환자 의사 상호 작용 감소와 관련이 있음을 발견했습니다. 우리의 추정치는 공개에 대한 반응으로 흑인 남성의 45세 기대 수명이 최대 1.5년 감소했음을 의미하며, 이는 1980년 흑인과 백인 남성 간의 기대 수명 격차의 약 35%와 흑인 남성과 여성 간의 격차의 25%를 차지합니다."

#### 타당성

유효한 인과 추론을 하려면 @sec-assump에서 논의할 몇 가지 가정이 필요합니다.
예측과 달리 일반적으로 인과 모델이 올바른지 확인할 수 없습니다.
즉, 우리가 만들어야 하는 대부분의 가정은 검증할 수 없습니다.
우리는 이 주제로 책 전체에서 계속해서 돌아올 것입니다. 이러한 가정의 기본부터 실용적인 의사 결정, 모델 문제 탐색에 이르기까지 말입니다.

### 왜 올바른 인과 모델이 최고의 예측 모델이 아닌가? {#sec-pred-or-explain}

이 시점에서 왜 올바른 인과 모델이 최고의 예측 모델이 아닌지 궁금할 수 있습니다.
두 가지가 관련이 있다는 것은 이치에 맞습니다. 당연히 다른 것을 유발하는 것은 예측 변수가 될 것입니다.
결국 모든 것은 인과 관계이므로 모든 예측 정보는 어떤 식으로든 우리가 예측하는 것의 인과 구조와 관련이 있습니다.
잘 예측하는 모델이 인과적이기도 하다는 것은 당연하지 않을까요?
*일부* 예측 모델이 훌륭한 인과 모델이 될 수 있고 그 반대의 경우도 마찬가지라는 것은 사실입니다.
불행히도 항상 그런 것은 아닙니다. 인과 효과는 특별히 잘 예측할 필요가 없으며 좋은 예측 변수는 인과적으로 편향되지 않을 필요가 없습니다[@shmueli2010a].
데이터만으로는 알 수 있는 방법이 없으며, 이는 @sec-quartets의 주제입니다.

인과적 관점을 먼저 살펴보겠습니다. 이것이 조금 더 간단하기 때문입니다.
결과 *및* 노출과 관련된 변수만 포함하는 노출에 대한 인과적으로 편향되지 않은 모델을 생각해 보십시오.
즉, 이 모델은 관심 있는 노출에 대한 올바른 답을 제공하지만 결과의 다른 예측 변수는 포함하지 않습니다(이는 @sec-strat-outcome에서 논의한 것처럼 때때로 좋은 생각일 수 있습니다).
결과에 많은 원인이 있는 경우 단일 노출과의 관계를 정확하게 설명하는 모델은 결과를 잘 예측하지 못할 가능성이 높습니다.
마찬가지로 노출이 결과에 미치는 실제 인과 효과가 작으면 예측 가치가 거의 없습니다.
즉, 모델의 예측 능력은 높든 작든 모델이 올바른 답을 제공하는지 구별하는 데 도움이 될 수 없습니다.
물론 낮은 예측 능력은 인과 효과가 응용 관점에서 그다지 유용하지 않다는 것을 나타낼 수도 있지만, 이는 여러 통계적 요인에 따라 달라집니다.

예측 모델이 항상 편향되지 않은 인과 모델이 아닌 데에는 두 가지 더 복잡한 이유가 있습니다.
첫 번째 이유로 인과적 관점에서 정확한 모델을 생각해 보겠습니다. 즉, 결과에 대한 효과를 추정하고 이러한 모든 효과는 편향되지 않았습니다.
이러한 이상적인 환경에서도 다른 모델을 사용하여 더 나은 예측을 얻을 수 있습니다.
그 이유는 예측 모델링의 편향-분산 트레이드오프와 관련이 있습니다.
효과가 작거나, 데이터가 노이즈가 많거나, 예측 변수가 고도로 상관되거나, 데이터가 많지 않은 경우 페널티 회귀와 같은 편향된 모델을 사용하는 것이 합리적일 수 있습니다.
이러한 모델은 데이터 외부 예측에서 분산을 개선하기 위해 의도적으로 편향을 도입합니다.
예측과 인과 추론의 목표가 다르기 때문에(정확한 예측, 일반적으로 데이터 외부 관찰 대 편향되지 않은 효과), 추론을 위한 최상의 모델이 반드시 최고의 예측 모델인 것은 아닙니다.

<!-- TODO: 증명하기 위해 시뮬레이션을 포함할 수도 있음? -->

둘째, 인과적 관점에서 편향된 변수는 종종 예측력을 동반합니다.
@sec-dags에서 모델에 포함해야 할 변수와 포함하지 *않아야* 할 변수에 대해 논의하겠지만, 간단한 예를 살펴보겠습니다.
교란된 관계의 유명한 예 중 하나는 여름철 아이스크림 판매와 범죄입니다.
[설명적으로 아이스크림 판매와 범죄는 관련이 있습니다](https://slate.com/news-and-politics/2013/07/warm-weather-homicide-rates-when-ice-cream-sales-rise-homicides-rise-coincidence.html). 그러나 이 관계는 날씨에 의해 교란됩니다. 예를 들어, 날씨가 더워지면 아이스크림 판매와 범죄 모두 증가합니다.
(물론 이것은 단순화된 것입니다. 날씨 자체가 범죄를 유발하는 것은 아니지만 인과 경로에 있습니다.)

어두운 방에 있다고 가정하는 사고 실험을 생각해 보십시오.
목표는 범죄를 예측하는 것이지만 날씨나 연중 시기를 모릅니다.
그러나 아이스크림 판매에 대한 정보는 가지고 있습니다.
아이스크림 판매가 범죄에 미치는 모델은 인과적 관점에서 편향될 것입니다. 즉, 모델이 효과를 나타내더라도 아이스크림 판매는 범죄를 유발하지 않습니다. 그러나 범죄 모델에 어느 정도 예측 가치를 제공할 것입니다.
이 두 가지 조건의 이유는 동일합니다. 날씨와 아이스크림 판매는 상관 관계가 있으며 날씨와 범죄도 마찬가지입니다.
아이스크림 판매는 불완전하더라도 날씨의 대리 역할을 성공적으로 수행할 수 있습니다.
그 결과 아이스크림 판매가 범죄에 미치는 인과적 영향에 대한 편향된 효과 추정치가 생성되지만 범죄에 대한 부분적으로 효과적인 예측이 생성됩니다.
인과적 관점에서 유효하지 않은 다른 변수도 자체적으로 편향되거나 인과 효과 추정치에 편향을 도입함으로써 종종 좋은 예측 가치를 제공합니다.
따라서 예측 정확도는 인과 관계의 좋은 척도가 아닙니다.

밀접하게 관련된 아이디어는 *표 2 오류*입니다. 건강 연구 논문에서 설명 분석은 종종 표 1에 제시되고 회귀 모델은 종종 표 2에 제시되기 때문에 그렇게 불립니다[@Westreich2013].
표 2 오류는 연구자가 교란 변수 및 기타 비노출 변수를 제시할 때, 특히 해당 계수를 마치 인과적인 것처럼 해석할 때 발생합니다.
문제는 일부 상황에서 한 변수의 편향되지 않은 효과를 추정하는 모델이 다른 변수의 편향되지 않은 효과를 추정하는 모델과 동일하지 않을 수 있다는 것입니다.
즉, 교란 변수의 효과를 인과적으로 해석할 수 없습니다. 왜냐하면 교란 변수 자체가 원래 노출과 관련 없는 다른 변수에 의해 교란될 수 있기 때문입니다.

설명적, 예측적, 인과적 분석은 항상 서로의 어떤 측면을 포함할 것입니다.
예측 모델은 결과의 인과 구조로부터 예측력의 일부를 얻고, 인과 모델은 결과에 대한 정보를 포함하기 때문에 어느 정도 예측력을 갖습니다.
그러나 동일한 데이터에서 동일한 모델이 다른 목표를 가질 경우 해당 목표에 따라 유용성이 달라집니다.
<!-- TODO: 섹션이 작성되면 이 주석 해제 -- @sec-causal-pred-revisit에서 이 주제에 대해 더 자세히 살펴볼 것입니다. -->

## 인과적 주장 도표화 {#sec-diag}

설명적이든, 예측적이든, 추론적이든 각 분석 작업은 명확하고 정확한 질문으로 시작해야 합니다.
인과적 질문의 구조를 더 잘 이해하기 위해 도표화해 보겠습니다(이에 대해서는 다시 초점을 맞출 것입니다).
문장 도표화는 문장의 구조를 시각적으로 나타내는 데 사용되는 문법적 방법으로, 때때로 문법 학교에서 가르칩니다.
이 기법에서 문장은 주어, 동사, 목적어, 수식어와 같은 구성 요소로 분해된 다음 일련의 선과 기호를 사용하여 표시됩니다.
다이어그램에서 이러한 요소의 배열은 구문적 역할과 문장의 전체 구조 내에서 상호 작용하는 방식을 반영합니다.
문장을 이러한 시각적 표현으로 분해함으로써 도표화는 학습자가 문장 구성의 미묘한 차이를 파악하고, 문법적 오류를 식별하고, 단어 간의 복잡한 연결을 이해하는 데 도움이 될 수 있습니다.
인과적 주장에도 비슷한 아이디어를 적용할 수 있습니다.
다음은 인과적 주장을 도표화하는 방법의 예입니다.
*원인*, *결과*, *주체*(누구를 위해?), *시기*(언제?)를 뽑아냈습니다.

```{r}
#| echo: false
#| fig-cap: "인과적 주장 도표화 예시."
#| fig-height: 2
#| label: fig-diagram-1
knitr::include_graphics("../images/sentence-diagram-1.png")
```

기본적인 인과적 질문부터 시작해 보겠습니다. 흡연은 폐암을 유발하는가?

여기서 인과적 주장은 흡연이 폐암을 유발한다는 것일 수 있습니다.
@fig-diagram-2는 이 인과적 주장의 잠재적인 다이어그램을 보여줍니다.

```{r}
#| echo: false
#| label: fig-diagram-2
#| fig-height: 2
#| fig-cap: "인과적 주장 \"흡연은 폐암을 유발한다\"의 다이어그램."
knitr::include_graphics("../images/sentence-diagram-2.png")
```

더 구체적으로 살펴보겠습니다.
2005년 *JAMA*(미국 의학 협회 저널)에 "흡연 감소가 폐암 위험에 미치는 영향"이라는 제목의 연구가 발표되었습니다. 이 연구는 다음과 같이 결론지었습니다. "하루 15개비 이상 흡연하는 개인의 경우 흡연량을 50% 줄이면 폐암 위험이 크게 감소합니다."
[@godtfredsen2005effect] 이 연구는 연구 기간을 5~10년으로 설명합니다.
이 인과적 주장을 도표화해 보겠습니다.
여기서는 적격성 기준과 추정된 인과 효과의 대상 모집단이 동일하다고 가정합니다(하루 15개비 이상 흡연하는 개인). 항상 그런 것은 아닙니다.
@sec-estimands에서는 다른 잠재적인 대상 모집단에 대해 논의할 것입니다.

```{r}
#| echo: false
#| fig-cap: "@godtfredsen2005effect의 결과를 기반으로 한 보다 구체적인 인과적 주장의 예시 다이어그램."
#| label: fig-diagram-3
knitr::include_graphics("../images/sentence-diagram-3.png")
```

이 아이디어를 좋은 인과적 질문을 하는 것으로 번역하면, 이 책 전체에서 보게 될 다음 용어를 이러한 다이어그램에 매핑할 수 있습니다. *노출*(원인), *결과*(효과), *적격성 기준*(누구를 위해?), *시간 0*(참가자 추적 시작 시점?), *대상 모집단*(누구에 대해 결과 효과를 추정할 수 있는가?), *추적 기간*(언제?).

```{r}
#| echo: false
#| label: fig-diagram-4
#| fig-height: 2
#| fig-cap: "인과 분석 용어에 매핑된 예시 다이어그램"
knitr::include_graphics("../images/sentence-diagram-4.png")
```

좋은 인과적 질문을 한다는 것은 질문을 관찰 가능한 증거에 매핑하는 것을 의미합니다.
흡연 예로 돌아가 보겠습니다.
초기 질문은 다음과 같았습니다. *흡연은 폐암을 유발하는가?* 연구의 증거는 하루 15개비 이상 흡연하는 사람들의 경우 흡연량을 50% 줄이면 5~10년 동안 폐암 위험이 감소한다는 것을 보여줍니다.
답이 질문과 일치하는가?
그렇지 않습니다.
연구가 실제로 보여준 것과 일치하도록 질문을 업데이트해 보겠습니다. *하루 15개비 이상 흡연하는 사람들의 경우 흡연량을 50% 줄이면 5~10년 동안 폐암 위험이 감소하는가?*
이 기술, 즉 답할 수 있는 인과적 질문을 하는 기술을 연마하는 것은 필수적이며 이 책 전체에서 논의할 것입니다.
